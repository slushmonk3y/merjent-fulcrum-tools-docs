<!-- start:source.tmpl.hbs -->
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width">
		<title>Mtools/Utils.js</title>
		<!--[if lt IE 9]>
		<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->
		<link href="https://fonts.googleapis.com/css?family=PT+Mono" rel="stylesheet">
		<link type="text/css" rel="stylesheet" href="css/bootstrap.min.css">
		<link type="text/css" rel="stylesheet" href="css/prism.min.css">
		<link type="text/css" rel="stylesheet" href="css/template.min.css">
		<script type="text/javascript">
			window.TEMPLATE_OPTIONS = {"includeDate":true,"dateFormat":"Do MMM YYYY","systemName":"Merjent Fulcrum Tools","systemSummary":"Version 0.5.5","systemLogo":"","systemColor":"","navMembers":[{"kind":"module","title":"Modules","summary":"All documented modules."},{"kind":"class","title":"Classes","summary":"All documented classes. View inheritance chains in each class description."},{"kind":"external","title":"Externals","summary":"All documented external members."},{"kind":"global","title":"Globals","summary":"All documented globals."},{"kind":"mixin","title":"Mixins","summary":"All documented mixins."},{"kind":"interface","title":"Interfaces","summary":"All documented interfaces."},{"kind":"namespace","title":"Namespaces","summary":"All documented namespaces."},{"kind":"tutorial","title":"Tutorials","summary":"All available tutorials."}],"footer":"","copyright":"Mtools Copyright © 2025 Mikel Paiva","linenums":true,"collapseSymbols":true,"inverseNav":true,"inlineNav":false,"outputSourceFiles":false,"sourceRootPath":null,"disablePackagePath":true,"outputSourcePath":false,"showTableOfContents":true,"showAccessFilter":true,"analytics":null,"methodHeadingReturns":true,"sort":"lineage, longname","search":true,"favicon":null,"stylesheets":[],"scripts":[],"monospaceLinks":false,"cleverLinks":true,"default":{"outputSourceFiles":false}};
			window.DOCLET_TOC_ENABLED = false;
			window.DOCLET_AFILTER_ENABLED = false;
		</script>
</head>
<body>
	<!-- start:navbar.hbs -->
	<header class="navbar navbar-default navbar-fixed-top navbar-inverse">
		<div class="container">
			<div class="navbar-header">
				<a class="navbar-brand" href="index.html">
					Merjent Fulcrum Tools
				</a>
				<!-- displayed on small devices -->
				<button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#topNavigation">
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
			</div>
			<div class="navbar-collapse collapse" id="topNavigation">
				<ul class="nav navbar-nav">
								<li class="dropdown">
									<a href="global.html" class="dropdown-toggle" data-toggle="dropdown">Globals<b class="caret"></b></a>
									<ul class="dropdown-menu">
											<li><a href="global.html#addCoordinatorInitials">addCoordinatorInitials</a></li>
											<li><a href="global.html#addLockEditing">addLockEditing</a></li>
											<li><a href="global.html#addUpdatePermission">addUpdatePermission</a></li>
											<li><a href="global.html#baseLockEditing">baseLockEditing</a></li>
											<li><a href="global.html#baseUpdatePermission">baseUpdatePermission</a></li>
											<li><a href="global.html#DefaultTemplate">DefaultTemplate</a></li>
											<li><a href="global.html#disableNewRecordCreation">disableNewRecordCreation</a></li>
											<li><a href="global.html#enterReportID">enterReportID</a></li>
											<li><a href="global.html#getCompleteLockStatus">getCompleteLockStatus</a></li>
											<li><a href="global.html#getLockStatus">getLockStatus</a></li>
											<li><a href="global.html#getPermissions">getPermissions</a></li>
											<li><a href="global.html#getStatus">getStatus</a></li>
											<li><a href="global.html#limitCaption">limitCaption</a></li>
											<li><a href="global.html#lockEditing">lockEditing</a></li>
											<li><a href="global.html#reportIDprefix">reportIDprefix</a></li>
											<li><a href="global.html#start">start</a></li>
											<li><a href="global.html#updateLock">updateLock</a></li>
											<li><a href="global.html#updatePermission">updatePermission</a></li>
											<li><a href="global.html#updateStatus">updateStatus</a></li>
											<li><a href="global.html#validateAllPhotos">validateAllPhotos</a></li>
											<li><a href="global.html#validatePhoto">validatePhoto</a></li>
									</ul>
								</li>
								<li class="dropdown">
									<a href="list_class.html" class="dropdown-toggle" data-toggle="dropdown">Classes<b class="caret"></b></a>
									<ul class="dropdown-menu">
											<li><a href="DataEventHelpers.html">DataEventHelpers</a></li>
											<li><a href="FieldHelpers.html">FieldHelpers</a></li>
											<li><a href="FieldHelpers.Mfld.html">FieldHelpers.Mfld</a></li>
											<li><a href="FieldHelpers.MfldColl.html">FieldHelpers.MfldColl</a></li>
											<li><a href="FulcrumHelpers.html">FulcrumHelpers</a></li>
											<li><a href="MerjentApp.html">MerjentApp</a></li>
											<li><a href="MLoadRecords.html">MLoadRecords</a></li>
											<li><a href="PhotoDirHandler.html">PhotoDirHandler</a></li>
											<li><a href="ReportHelpers.html">ReportHelpers</a></li>
											<li><a href="ReportHelpers.SecOpt.html">ReportHelpers.SecOpt</a></li>
											<li><a href="RequestHelpers.html">RequestHelpers</a></li>
											<li><a href="Utils.html">Utils</a></li>
									</ul>
								</li>
								<li class="dropdown">
									<a href="list_module.html" class="dropdown-toggle" data-toggle="dropdown">Modules<b class="caret"></b></a>
									<ul class="dropdown-menu">
											<li><a href="module-MtoolsDataEvents.html">MtoolsDataEvents</a></li>
											<li><a href="module-MtoolsMerjentApp.html">MtoolsMerjentApp</a></li>
											<li><a href="module-MtoolsReports.html">MtoolsReports</a></li>
											<li><a href="module-MtoolsUtils.html">MtoolsUtils</a></li>
									</ul>
								</li>
								<li class="dropdown">
									<a href="list_namespace.html" class="dropdown-toggle" data-toggle="dropdown">Namespaces<b class="caret"></b></a>
									<ul class="dropdown-menu">
											<li><a href="LockingMixins.html">LockingMixins</a></li>
											<li><a href="PermissionMixins.html">PermissionMixins</a></li>
											<li><a href="PhotoMixins.html">PhotoMixins</a></li>
											<li><a href="StatusMixins.html">StatusMixins</a></li>
									</ul>
								</li>
								<li class="dropdown">
									<a href="list_tutorial.html" class="dropdown-toggle" data-toggle="dropdown">Tutorials<b class="caret"></b></a>
									<ul class="dropdown-menu">
											<li><a href="tutorial-CHANGELOG.html">CHANGELOG</a></li>
											<li><a href="tutorial-01_overview.html">01_overview</a></li>
											<li><a href="tutorial-02_5_mloadrecords.html">02_5_mloadrecords</a></li>
											<li><a href="tutorial-02_mtools.html">02_mtools</a></li>
											<li><a href="tutorial-03_mapp.html">03_mapp</a></li>
											<li><a href="tutorial-04_pdf-reports.html">04_pdf-reports</a></li>
											<li><a href="tutorial-06_merjent-dev.html">06_merjent-dev</a></li>
											<li><a href="tutorial-07_general-dev.html">07_general-dev</a></li>
									</ul>
								</li>
				</ul>
					<!-- start:lunr-search-navbar.hbs -->
					<form class="navbar-form navbar-right" role="search">
						<div class="input-group">
							<input type="text" class="form-control" placeholder="Search" id="lunr-search-input">
							<div class="input-group-btn">
								<button class="btn btn-default" id="lunr-search-submit">
									<i class="glyphicon glyphicon-search"></i>
								</button>
							</div>
						</div>
					</form>
					<!-- start:lunr-search-navbar.hbs -->		</div>
		</div>
	</header>
	<!-- end:navbar.hbs -->		<div class="page-header">
			<div class="container">
				<span class="kind">source</span>
				<h1><span class="name">Mtools/Utils.js</span></h1>
			</div>
		</div>
	<div class="container content">
		<div class="row">
			<div class="col-md-12 main-content">
		<section class="source-section">
			<article></article>
			<pre class="prettyprint source language-javascript line-numbers"><code class="language-javascript">//#region ********************************** UTILS *****************************************/
/**
 * @class Utils
 * @summary Utility helper methods
 * @description For use in any JavaScript project, including Google Apps scripts etc.
 * All methods are available as both static and instance methods for flexibility.
 *
 * **Hybrid Class Pattern:**
 * - All utility methods are implemented as **static methods** (e.g., `Utils.isBlank()`)
 * - The same methods are also available as **instance methods** (e.g., `M.isBlank()`)
 * - Instance methods are simple delegates to the static methods
 * - Full documentation is provided for static methods only to avoid duplication in child class documentation
 *
 * **Base class** - Extended by {@link FulcrumHelpers}
 */
class Utils {
  constructor(){ }

  //#region =============== STATIC METHODS (Primary Implementation) ===============

  /**
   * @summary Add leading zeroes to a number(or string number).
   * @description Pads a number **OR** string with leading zeroes to reach a specified total length.
   * Returns a string with leading zeroes.
   * @example Utils.padZero(1.35,5) //returns: "001.35"
   * @param {number | string} val
   * @param {number} len
   * @returns {string}
   */
  static padZero(val, len){
    if (val === null || val === undefined) {
      throw new Error('Mtools - padZero: val cannot be null or undefined');
    }
    if (!Number.isInteger(len) || len &lt; 0) {
      throw new Error('Mtools - padZero: len must be a non-negative integer');
    }
    return val.toString().padStart(len, '0');
  }

  /**
   * @summary *Array Sort* - Sorts an array, defaults to ascending order.
   * @description Sorts an array of strings, numbers, or dates in ascending or descending order.
   * Defaults to ascending order.
   * Automatically determines data type of array contents. **MUTATES** original array.
   * @param {Array} arr - Array of strings, numbers, or date strings/objects.
   * @param {boolean} [asc=true] - Sort ascending (true) or descending (false).
   * @returns {void} - Sorted array (mutates original array).
   */
  static arrSort(arr = [], asc = true){
    return arr.sort((a, b) => {
      // Try to detect numbers
      if (Utils.isNumber(a) &amp;&amp; Utils.isNumber(b)) {
        return asc ? Number(a) - Number(b) : Number(b) - Number(a);
      }
      // Try to detect dates
      if (Utils.isDate(a) &amp;&amp; Utils.isDate(b)) {
        return asc ? new Date(a) - new Date(b) : new Date(b) - new Date(a);
      }
      // Default: string comparison
      if (a &lt; b) return asc ? -1 : 1;
      if (a > b) return asc ? 1 : -1;
      return 0;
    });
  }

  /**
   * @summary *Array Reverse* - Sorts an array in descending order.
   * @description Sorts an array of strings, numbers, or dates in descending order.
   * Automatically determines data type of array contents. **MUTATES** original array.
   * @param {Array} arr - Array of strings, numbers, or date strings/objects.
   * @returns {void} - Sorted array (mutates original array).
   */
  static arrReverse(arr = []){
    return Utils.arrSort(arr, false);
  }

  /**
   * @summary *Array to Sorted* - Sorts an array, defaults to ascending order.
   * @description Sorts an array of strings, numbers, or dates in ascending or descending order.
   * Defaults to ascending order.
   * Automatically determines data type of array contents. Returns a **new** array.
   * @param {Array} arr - Array of strings, numbers, or date strings/objects.
   * @param {boolean} [asc=true] - Sort ascending (true) or descending (false).
   * @returns {Array} - Sorted array (new array, does not mutate original).
   */
  static arr2Sorted(arr = [], asc = true){
    var newArr = arr.slice()
    return Utils.arrSort(newArr, asc);
  }

  /**
   * @summary *Array to Reversed* - Sorts an array in descending order.
   * @description Sorts an array of strings, numbers, or dates in descending order.
   * Automatically determines data type of array contents. Returns a **new** array.
   * @param {Array} arr - Array of strings, numbers, or date strings/objects.
   * @returns {Array} - Sorted array (new array, does not mutate original).
   */
  static arr2Reversed(arr = []){
    var newArr = arr.slice()
    return Utils.arrSort(newArr, false);
  }

  /**
   * @summary *Array Remove* - Remove element from array.
   * @description Remove element **OR** elements from array, needle can be a single element or an array of elements.
   * ie: Remove data_name string from array of data_names. Return new list of field names.
   * **MUTATES** original array.
   * @param {Array} haystack - array to add element to
   * @param {any} needle - element to remove from array
   * @returns {void} - mutates original array
   */
  static arrRem(haystack, needle){
    const toRemove = Array.isArray(needle) ? needle : [needle];
    const removeSet = new Set(toRemove);

    for (let i = haystack.length - 1; i >= 0; i--) {
      if (removeSet.has(haystack[i])) {
        haystack.splice(i, 1);
      }
    }
  }

  /**
   * @summary *Array to Remove* - Return new array with elements removed.
   * @description Remove element **OR** elements from array, needle can be a single element or an array of elements.
   * ie: Remove data_name string from array of data_names. Return new list of field names.
   * Returns a **new** array.
   * @param {Array} haystack - array to add element to
   * @param {any} needle - element to remove from array
   * @returns {Array} - returns new array with elements removed.
   */
  static arr2Rem(haystack, needle){
    const toRemove = Array.isArray(needle) ? needle : [needle];
    const removeSet = new Set(toRemove);

    return haystack.filter(item => !removeSet.has(item));
  }

  /**
   * @summary *Array Splice* - Add element to array, default to end of array.
   * @description Add element to array at position "pos". MUTATES the existing array.
   * ie: Add field name string to list of field names at position "pos". Return new list of field names.
   *
   * MUTATES existing array.
   * @param {Array} haystack - array to add element to
   * @param {any} needle - element to add to array
   * @param {number} pos - position in array to add element
   * @returns {void}
   * @todo change to arrInsert
   */
  static arrSplice(haystack, needle, pos=null){
    const position = pos ?? haystack.length;  // Handles 0 correctly
    haystack.splice(position, 0, needle);
  }

  /**
   * @summary *Date Add Days* - Adds days to a date.
   * @description Adds a number of days to a date and returns the new date.
   * Input can be a Date object or a date string.
   * @param {Date|string} dt - The starting date (Date object or date string).
   * @param {number} days - Number of days to add.
   * @returns {Date} - The new Date object.
   */
  static dtAddDays(dt, days) {
    const d = new Date(dt);
    d.setDate(d.getDate() + days);
    return d;
  }

  /**
   * @summary *Date Month Bounds* - Get first and last day of month for a given date.
   * @description Returns the first and last day of the month for a given date.
   * @param {Date|string} dt - A Date object or date string.
   * @returns {{first: Date, last: Date}}
   */
  static dtMonthBounds(dt) {
    const d = new Date(dt);
    const first = new Date(d.getFullYear(), d.getMonth(), 1);
    const last = new Date(d.getFullYear(), d.getMonth() + 1, 0);
    return { first, last };
  }

  /**
   * @summary *Date Days Difference* - Calculate the difference in days between two dates.
   * @description Calculate the difference in days between two dates.
   * @param {Date} dt1
   * @param {Date} dt2
   * @returns {number}
   */
  static dtDaysDiff(dt1 = new Date(), dt2 = new Date()) {
    if (!Utils.isDate(dt1) || !Utils.isDate(dt2)) {
      throw new Error('Mtools - dtDaysDiff: both arguments must be valid Date objects or date strings');
    }
    const date1 = dt1 instanceof Date ? dt1 : new Date(dt1);
    const date2 = dt2 instanceof Date ? dt2 : new Date(dt2);
    return Math.round((date2.getTime() - date1.getTime()) / (1000 * 3600 * 24));
  }

  /**
   * @summary *ISO to Date* - Convert ISO to Date.
   * @description Convert ISO date in string format to javascript date/unix timestamp.
   * Strips time and timezone if present before conversion.
   * @param {string} str - ISO date in string format
   * @returns {Date}
   */
  static iso2dt(str = '') {
    return new Date(Utils.dtStrip(str));
  }

  /**
   * @summary *Date Strip* - Strip timezone and time from ISO String date.
   * @description Strip timezone and time from ISO date and time in string format
   *
   * ie: '2024-09-09T16:23:47Z' returns '2024-09-09'
   * @param {string} str - ISO date in string format
   * @returns {string}
   */
  static dtStrip(str = '') {
    return str.split('T')[0];
  }

  /**
   * @summary *Date to ISO* - Convert Date to ISO string.
   * @description Convert javascript date/unix timestamp to ISO string with time and timezone stripped.
   * Strips time and timezone from ISO string.
   * @param {Date} dt - ISO date in string format
   * @returns {string}
   */
  static dt2iso(dt = new Date()) {
    return dt.toISOString().split('T')[0];
  }

  /**
   * @summary *Date String to ISO Date* - Convert any date string to ISO date format.
   * @description Parses any valid date string format and returns it as ISO date (YYYY-MM-DD) without time or timezone.
   * @param {string} dateStr - Date string in any parseable format
   * @returns {string} ISO date string (YYYY-MM-DD) or original value if not a valid date string
   */
  static dtStr2iso(dateStr) {
    if (!Utils.isDateStr(dateStr)) return dateStr;
    const dt = new Date(dateStr);
    return Utils.dt2iso(dt);
  }

  /**
   * @summary *Array Any in Array* - Check if any string in one array is in another array.
   * @description Returns true if any string in arr1 matches any string in arr2.
   * @param {string[]} arr1
   * @param {string[]} arr2
   * @returns {boolean}
   */
  static arrAnyInArr(arr1, arr2){
    return arr1.some(item1 => arr2.includes(item1));
  }

  /**
   * @summary *Array Count Items* - Count occurrences of items in an array.
   * @description Counts the number of occurrences of each unique item in an array and returns an array of objects,
   * each with properties 'item' and 'count', sorted by count descending.
   * Example: *['a','b','a'] => [ { item: 'a', count: 2 }, { item: 'b', count: 1 } ]*
   * @param {Array.&lt;string|number>} arr - Array of primitive values to count.
   * @returns {Array.&lt;{item: (string|number), count: number}>} Array of {item, count} objects sorted by descending count. Returns empty array if input array is empty.
   */
  static arrCountItems(arr = []){
    const countObj = arr.reduce((acc, el) => {
      acc[el] = (acc[el] || 0) + 1;
      return acc;
    }, {});
    const arrOfObj = Object.entries(countObj).map(([item, count]) => ({ item, count }));
    return Utils.rows2Sorted(arrOfObj, 'count', false, 'number');
  }

  /**
   * @summary *Array List Duplicates* - List duplicate values in an array.
   * @description Creates an array containing all values that are present in array more then once.
   * Also see arrUnique to filter an array down to only unique values.
   * @param {Array} arr
   * @returns {Array}
   */
  static arrListDups(arr = []){
    if (!Array.isArray(arr) || arr.length === 0) return [];
    const counts = arr.reduce((acc, item) => {
      acc[item] = (acc[item] || 0) + 1;
      return acc;
    }, {});
    return Object.keys(counts).filter(item => counts[item] > 1);
  }

  /**
   * @summary *Array Unique* - Filter array to unique values.
   * @description Filter an array down to an array of unique values
   * @param {Array} arr
   * @returns {Array}
   */
  static arrUnique(arr){
    return [...new Set(arr)];
  }

  /**
   * @summary *String After* - Return slice AFTER **FIRST** occurence.
   * @description Return slice of string AFTER **FIRST** occurence of search string.
   * Useful for getting **middle** section of text after underscore in data_name.
   * @param {string} val - string to search IN
   * @param {string} search - string to search FOR in val
   * @returns {string}
   */
  static strAfter(val='',search='_'){
    const i = val.indexOf(search)
    return i === -1 ? val : val.slice(i+search.length)
  }

  /**
   * @summary *String Suffix* - Return slice AFTER **LAST** occurence.
   * @description Return slice of string AFTER **LAST** occurence of search string.
   * Useful for getting suffix of text after last underscore in data_name.
   * @param {string} val - string to search IN
   * @param {string} search - string to search FOR in val
   * @returns {string}
   */
  static strSuff(val='',search='_'){
    const i = val.lastIndexOf(search)
    return i === -1 ? val : val.slice(i+search.length)
  }

  /**
   * @summary *String Before* - Return slice BEFORE **FIRST** occurence.
   * @description Return slice of string BEFORE **FIRST** occurence of search string.
   * Useful for getting prefix of text before first underscore in data_name.
   * @param {string} val - string to search IN
   * @param {string} search - string to search FOR in val
   * @returns {string}
   */
  static strBefore(val='',search='_'){
    const i = val.indexOf(search);
    return i === -1 ? val : val.slice(0, i);
  }

  /**
   * @summary Determines if a value is a number.
   * @description Determines if a value is a number (not NaN, not a string).
   * @param {any} val
   * @returns {boolean}
   */
  static isNumber(val) {
    return Number.isFinite(val)
  }

  /**
   * @summary Determines if a value is a valid Date object or a valid date string.
   * @description returns true if val is a Date object or a valid date string.
   * @param {any} val
   * @returns {boolean}
   */
  static isDate(val) {
    // Date objects: check if valid
    if (val instanceof Date) {
      return !isNaN(val.getTime());
    }

    // Date strings: delegate to isDateStr
    if (typeof val === 'string') {
      return Utils.isDateStr(val);
    }

    return false;
  }

  /**
   * @summary Determines if a string is a valid date string.
   * @description Validates if a string can be parsed as a valid date, including ISO 8601 format and other common date formats.
   * Rejects strings that don't match common date patterns to avoid false positives from JavaScript's permissive Date parser.
   * @param {string} str
   * @returns {boolean}
   */
  static isDateStr(str) {
    if (typeof str !== 'string') return false;

    const trimmed = str.trim();
    if (trimmed === '') return false; // Empty strings shouldn't be dates

    // Check if it's an ISO date string first
    if (Utils.isISOdt(trimmed)) return true;

    // Pattern-based validation to prevent false positives
    // Accept strings that look like dates before attempting to parse
    const datePatterns = [
      /^\d{4}-\d{1,2}-\d{1,2}$/,                    // YYYY-MM-DD or YYYY-M-D
      /^\d{1,2}[\/\-]\d{1,2}[\/\-]\d{2,4}$/,        // MM/DD/YYYY, M/D/YY, etc.
      /^\d{4}[\/\-]\d{1,2}[\/\-]\d{1,2}/,           // YYYY/MM/DD with optional time
      /^[A-Za-z]{3,9}\s+\d{1,2},?\s+\d{4}$/,        // Month DD, YYYY or Month DD YYYY
      /^\d{1,2}\s+[A-Za-z]{3,9}\s+\d{4}$/,          // DD Month YYYY
      /^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}/,       // ISO datetime
      /^\d{1,2}[\/\-]\d{1,2}[\/\-]\d{2,4}\s+\d{1,2}:\d{2}/  // Date with time
    ];

    const matchesPattern = datePatterns.some(pattern => pattern.test(trimmed));
    if (!matchesPattern) return false;

    // For strings matching date patterns, validate they're parseable
    const d = new Date(trimmed);
    if (isNaN(d.getTime())) return false;

    // Reject ambiguous dates like bare numbers
    // "123" parses as a date but is probably not intended
    if (/^\d+$/.test(trimmed) &amp;&amp; trimmed.length &lt; 4) return false;

    return true;
  }

  /**
   * @summary Check if string is in ISO 8601 date format.
   * @description Checks if string is in the format of an ISO 8601 date format
   * ie: '2011-10-05T14:48:00.000Z'
   * @param {string} str
   * @returns {boolean}
   */
  static isISOdt(str = '') {
    if (typeof str !== 'string' || str.trim() === '') return false;

    const d = new Date(str);
    if (isNaN(d.getTime())) return false;

    // Round-trip test: if parsing and re-serializing produces the same string, then the input was in exact ISO 8601 format
    return d.toISOString() === str;
  }

  /**
   * @summary Check if variable is blank.
   * @description Check if variable is undefined, null or '' (empty string) OR if it is an Array if it has a length of 0 OR if it is an Object if it has an Object.keys() length of 0
   * @param {any} val
   * @returns {boolean}
   */
  static isBlank(val) {
    if (val === undefined || val === null) return true;
    if (Utils.isNumber(val) || typeof val === 'boolean') return false;
    if (typeof val === 'string') return val.trim() === '';
    if (Array.isArray(val)) return val.length === 0;

    // Handle Set and Map
    if (val instanceof Set || val instanceof Map) return val.size === 0;

    // Plain objects
    if (typeof val === 'object' &amp;&amp; val.constructor === Object) {
      return Object.keys(val).length === 0;
    }

    return false;
  }

  /**
   * @summary Check if value is a Fulcrum choice field object
   * @description Validates if object has choice_values array property
   * @param {any} val
   * @returns {boolean}
   */
  static isChoiceFieldValue(val) {
    return (
      typeof val === 'object' &amp;&amp;
      val !== null &amp;&amp;
      'choice_values' in val &amp;&amp;
      Array.isArray(val.choice_values)
    );
  }

  /**
   * @summary Check if value is a Fulcrum address field object
   * @description Validates if object has standard address properties
   * @param {any} val
   * @returns {boolean}
   */
  static isAddressFieldValue(val) {
    return (
      typeof val === 'object' &amp;&amp;
      val !== null &amp;&amp;
      ('thoroughfare' in val || 'locality' in val || 'postal_code' in val)
    );
  }

  /**
   * @summary *Format Value* - Format unknown value to printable String.
   * @description Format unknown value to Merjent standard formatted String.
   * Useful for values returned from Query API or REPEATABLEVALUES.
   * This function is intended for unknown values that are not returned from a fulcrum field.
   * For values from a fulcrum field use the fldVal method.
   * @example
   * fVal('2011-10-05T14:48:00.000Z') // returns '2011-10-05'
   * fVal(['apples','oranges','bananas']) // returns 'apples, oranges, bananas'
   * @param {any} val
   * @param {string} [naVal='---'] - Value for null, undefined and empty strings
   * @returns {string}
   */
  static fVal(val, naVal = null) {
    const notAvailable = naVal || '---';

    if (Utils.isBlank(val)) return notAvailable;

    // Handle arrays first (arrays are objects, so check before object checks)
    if (Array.isArray(val)) return val.join(', ');

    // Handle Date objects
    if (val instanceof Date) return Utils.dt2iso(val);

    // Handle Fulcrum-specific objects
    if (Utils.isAddressFieldValue(val)) {
      return Utils.formatAddress(val);
    }

    if (Utils.isChoiceFieldValue(val)) {
      const choices = val.choice_values.join(', ');
      const others = Array.isArray(val.other_values) &amp;&amp; val.other_values.length > 0
        ? ', ' + val.other_values.join(', ')
        : '';
      return choices + others;
    }

    // Handle date strings (any format)
    if (Utils.isDateStr(val)) {
      return Utils.dtStr2iso(val);
    }

    // Handle primitives (number, boolean, regular strings)
    if (typeof val === 'number' || typeof val === 'boolean') {
      return val.toString();
    }

    // Fallback: return as-is
    return val;
  }

  /**
   * @summary *Format Address*
   * @description Formats a fulcrum address object into a us address formated string.
   * @param {Object} val
   * @returns {string}
   * @todo addr2Str
   */
  static formatAddress(val = {}) {
    const {
      sub_thoroughfare: sub = '',
      thoroughfare: street = '',
      locality: city = '',
      sub_admin_area: county = '',
      admin_area: state = '',
      postal_code: post = '',
      suite = ''
    } = val;

    const cityPart = city ? city + ', ' : '';
    const countyPart = county ? county + ', ' : '';

    return `${sub} ${street} ${suite} ${cityPart}${countyPart}${state} ${post}`.trim();
  }

  /**
   * @summary *Flip Key:Value Pair* - Flips keys and values in an object.
   * @description Flips keys and values in an object. Object must have unique values.
   * Input is an Object **NOT** an array of objects.
   * @param {*} obj
   * @returns {*}
   * @todo obj2Flipped
   */
  static flipKVpair(obj){
    return Object.fromEntries(Object.entries(obj).map(([k,v])=>[v,k]))
  }

  /**
   * @summary *Clean HTML* - Removes newlines and trims whitespace from template literal.
   * @description Useful for embedding HTML snippets in JavaScript without extra whitespace or newlines.
   * removes all newline characters (\r and \n).
   * removes any leading or trailing whitespace.
   * @param {string} strings
   * @param {...{}} vals
   * @returns {*}
   * @todo better name? cleanTemplateLiteral?
   */
  static str2html(strings, ...vals){
    let result = '';
    strings.forEach((str, i) => {
      result += str + (vals[i] ?? '');
    });
    return result.replace(/[\r\n]+/gm, '').trim();
  }


  /**
   * @summary *String Proper* - Capitalizes the first character of a word
   * @description Capitalizes the first character of a word and converts the rest to lowercase.
   * @param {string} word - The word to capitalize.
   * @returns {string} - The capitalized word.
   */
  static strProper(word) {
    return word.charAt(0).toUpperCase() + word.slice(1).toLowerCase();
  }

  /**
   * @summary *data_name to Title* - Converts a string with underscores to title case.
   * @description Converts a string to title case by replacing '_' with a ' ' and applying capitalization to each word.
   * Use to convert Fulcrum data_name strings to title case.
   * @param {string} str - The input string.
   * @returns {string} - The string converted to title case.
   * @todo change to str2Title
   */
  static dn2Title(str) {
    const spaced = str.replace(/_/g, ' ');
    return spaced.replace(/\w\S*/g, word => Utils.strProper(word));
  }


  /**
   * Convert string to snake_case
   * @param {string} str - Input string
   * @returns {string} Snake case string
   * @example
   * str2Snake("camelCase")        // "camel_case"
   * str2Snake("PascalCase")       // "pascal_case"
   * str2Snake("kebab-case")       // "kebab_case"
   * str2Snake("Title Case")       // "title_case"
   * str2Snake("SCREAMING_SNAKE")  // "screaming_snake"
   * str2Snake("mixedUP_string")   // "mixed_up_string"
   */
  static str2Snake(str) {
    return str
      // Insert underscore before uppercase letters (camelCase/PascalCase)
      .replace(/([a-z0-9])([A-Z])/g, '$1_$2')
      // Replace spaces and hyphens with underscores
      .replace(/[\s-]+/g, '_')
      // Remove any non-alphanumeric characters except underscores
      .replace(/[^\w]/g, '')
      // Convert to lowercase
      .toLowerCase()
      // Remove consecutive underscores
      .replace(/_+/g, '_')
      // Remove leading/trailing underscores
      .replace(/^_|_$/g, '');
  }

  /**
   * @summary *Rows Find* - Find objects in array by property value.
   * @description Finds objects with property matching lookup value in an array of objects and returns that object.
   * @param {Object[]} rows - The array of objects to search.
   * @param {string} key - The property to look up in the objects.
   * @param {string} val - The value to match against the property.
   * @returns {Object[]}
   */
  static rowsFind(rows, key, val) {
    const results = rows.filter(row => row[key] === val);
    return results.length > 0 ? results : null;
  }

  /**
   * @summary *Rows Remove* - Remove objects from array by property value(s).
   * @description Removes all objects where the specified property matches the value or any value in array.
   * **MUTATES** original array.
   * @example
   * const users = [{id: 1}, {id: 2}, {id: 3}];
   * M.rowsRem(users, 'id', [1, 3]); // users is now [{id: 2}]
   * @param {Object[]} rows - Array of objects to filter
   * @param {string} key - Property name to check
   * @param {any|any[]} val - Value(s) to match for removal
   * @returns {void} - Mutates original array
   */
  static rowsRem(rows, key, val) {
    const toRemove = Array.isArray(val) ? new Set(val) : new Set([val]);

    for (let i = rows.length - 1; i >= 0; i--) {
      if (toRemove.has(rows[i][key])) {
        rows.splice(i, 1);
      }
    }
  }

  /**
   * @summary *Rows to Remove* - Return new array with objects removed by property value(s).
   * @description Removes all objects where the specified property matches the value or any value in array.
   * Returns a **new** array.
   * @example
   * const users = [{id: 1}, {id: 2}, {id: 3}];
   * const filtered = M.rows2Rem(users, 'id', [1, 3]); // returns [{id: 2}]
   * @param {Object[]} rows - Array of objects to filter
   * @param {string} key - Property name to check
   * @param {any|any[]} val - Value(s) to match for removal
   * @returns {Object[]} - New array with matching objects removed
   */
  static rows2Rem(rows, key, val) {
    const toRemove = Array.isArray(val) ? new Set(val) : new Set([val]);
    return rows.filter(row => !toRemove.has(row[key]));
  }

  /**
   * @summary *Rows to Sorted* - Sorts an array of Objects, defaults to ascending order.
   * @description Sorts an array of objects by a given property,
   * or by value if objects contain only one key:value pair and parameter 'key' is null.
   * Automatically sorts as number if type is 'number' or values are numbers,
   * and as date if type is 'date' or values are valid dates. Returns a **new** array.
   * @param {Object[]} arr - Array of objects to sort.
   * @param {string|null} key - Property name to sort by, or null to sort by value if objects have only one key:value pair.
   * @param {boolean} [asc=true] - Sort ascending (true) or descending (false).
   * @param {'string'|'number'|'date'} [type='string'] - Type of property to sort by.
   * @returns {Object[]} - Sorted array (new array, does not mutate original).
   */
  static rows2Sorted(arr, key = null, asc = true, type = 'string'){
    return arr.slice().sort((a, b) => {
      let valA, valB;
      if (key === null &amp;&amp; Object.keys(a).length === 1 &amp;&amp; Object.keys(b).length === 1) {
        valA = Object.values(a)[0];
        valB = Object.values(b)[0];
      } else {
        valA = a[key];
        valB = b[key];
      }

      // Auto-detect number
      if (type === 'number' || (Utils.isNumber(valA) &amp;&amp; Utils.isNumber(valB))) {
        valA = Number(valA);
        valB = Number(valB);
        return asc ? valA - valB : valB - valA;
      }

      // Auto-detect date - use isDate() helper and parse once
      if (type === 'date' || (Utils.isDate(valA) &amp;&amp; Utils.isDate(valB))) {
        const dateA = valA instanceof Date ? valA : new Date(valA);
        const dateB = valB instanceof Date ? valB : new Date(valB);
        return asc ? dateA - dateB : dateB - dateA;
      }

      // Default: string comparison
      if (valA &lt; valB) return asc ? -1 : 1;
      if (valA > valB) return asc ? 1 : -1;
      return 0;
    });
  }

  /**
   * @summary *Decimal Degrees to DMS*
   * @description Converts decimal degrees to Degrees, Minutes, Seconds (DMS) format.
   *
   * @param {number} dd - The decimal degrees value (e.g., 40.6892). Positive for N/E, negative for S/W.
   * @param {boolean} isLat - true for latitude, false for longitude.
   * @returns {array} [degrees,minutes,seconds,direction,The DMS string (e.g., "40° 41' 21.12" N")]
   */
  static dd2dms(dd, isLat) {
    if (!Utils.isNumber(dd)) {
      throw new Error('Mtools - dd2dms: dd must be a valid number');
    }
    if (typeof isLat !== 'boolean') {
      throw new Error('Mtools - dd2dms: isLat must be a boolean');
    }
    // Validate latitude range
    if (isLat &amp;&amp; (dd &lt; -90 || dd > 90)) {
      throw new Error('Mtools - dd2dms: latitude must be between -90 and 90 degrees');
    }
    // Validate longitude range
    if (!isLat &amp;&amp; (dd &lt; -180 || dd > 180)) {
      throw new Error('Mtools - dd2dms: longitude must be between -180 and 180 degrees');
    }

    const absDeg = Math.abs(dd);
    const deg = Math.floor(absDeg);
    const minD = (absDeg - deg) * 60;
    const min = Math.floor(minD);
    const sec = (minD - min) * 60;
    let dir = ''; // direction (N/S for latitude, E/W for longitude)

    if (isLat) {
      dir = dd >= 0 ? 'N' : 'S';
    } else { // Must be Longitude
      dir = dd >= 0 ? 'E' : 'W';
    }

    const fSec = sec.toFixed(2);

    return [deg,min,fSec,dir,`${deg}° ${min}' ${fSec}" ${dir}`];
  }

  /**
   * @summary *DMS to Decimal Degrees*
   * @description Converts Degrees, Minutes, Seconds (DMS) to Decimal Degrees.
   * Input direction is optional and defaults to 'N' or 'E' (ie: positive number in DD).
   *
   * @param {number} deg The degrees part (e.g., 40).
   * @param {number} min The minutes part (e.g., 41).
   * @param {number} sec The seconds part (e.g., 21.12).
   * @param {string} [dir='N'] The directional quadrant (N, S, E, or W).
   * @returns {number} The decimal degrees value (e.g., 40.6892).
   */
  static dms2dd(deg, min, sec, dir = 'N') {
    if (!Utils.isNumber(deg) || !Utils.isNumber(min) || !Utils.isNumber(sec)) {
      throw new Error('Mtools - dms2dd: deg, min, and sec must be valid numbers');
    }
    if (deg &lt; 0 || min &lt; 0 || min >= 60 || sec &lt; 0 || sec >= 60) {
      throw new Error('Mtools - dms2dd: deg must be non-negative, min and sec must be in range [0, 60)');
    }
    const upperDirection = dir.toUpperCase();
    if (!['N', 'S', 'E', 'W'].includes(upperDirection)) {
      throw new Error('Mtools - dms2dd: dir must be N, S, E, or W');
    }

    let result = deg + (min / 60) + (sec / 3600);
    if (upperDirection === 'S' || upperDirection === 'W') {
      result = -result;
    }

    return result;
  }

  /**
   * Convert degrees to compass direction
   * @param {number} degrees - Direction in degrees (0-360)
   * @param {boolean} [secondary=false] - If true, uses 16-point compass. If false, uses 8-point compass.
   * @returns {string} Compass direction
   * @example
   * Utils.deg2Dir(0)           // "N"
   * Utils.deg2Dir(45)          // "NE" (default 8-point)
   * Utils.deg2Dir(45, true)    // "NE"
   * Utils.deg2Dir(22.5)        // "NE" (8-point, 22.5° is center of NE range)
   * Utils.deg2Dir(22.5, true)  // "NNE" (16-point, 22.5° is center of NNE)
   * Utils.deg2Dir(67.5, true)  // "ENE"
   * Utils.deg2Dir(11)          // "N" (just before NE range starts at 22.5°)
   */
  static deg2Dir(degrees, secondary = false) {
    // Normalize to 0-360 range
    degrees = ((degrees % 360) + 360) % 360;

    if (secondary) {
      const directions = [
        'N', 'NNE', 'NE', 'ENE',
        'E', 'ESE', 'SE', 'SSE',
        'S', 'SSW', 'SW', 'WSW',
        'W', 'WNW', 'NW', 'NNW'
      ];
      const index = Math.floor((degrees + 11.25) / 22.5) % 16;
      return directions[index];
    } else {
      // Default to 8-point compass
      const directions = ['N', 'NE', 'E', 'SE', 'S', 'SW', 'W', 'NW'];
      const index = Math.floor((degrees + 22.5) / 45) % 8;
      return directions[index];
    }
  }

  /**
   * Convert compass direction to degrees
   * @param {string} direction - Compass direction (e.g., "N", "NE", "NNE", etc.)
   * @param {boolean} [secondary=false] - If true, accepts 16-point compass (includes NNE, ENE, etc.). If false, accepts only 8-point compass.
   * @returns {number} Direction in degrees (0-360), or null if invalid direction
   * @example
   * Utils.dir2Deg("N")           // 0
   * Utils.dir2Deg("NE")          // 45
   * Utils.dir2Deg("E")           // 90
   * Utils.dir2Deg("NNE")         // null (secondary = false by default)
   * Utils.dir2Deg("NNE", true)   // 22.5
   * Utils.dir2Deg("ENE", true)   // 67.5
   * Utils.dir2Deg("n")           // 0 (case-insensitive)
   */
  static dir2Deg(direction, secondary = false) {
    direction = direction.toUpperCase().trim();

    // 8-point compass (cardinal and intercardinal)
    const directionMap8 = {
      'N': 0, 'NE': 45, 'E': 90, 'SE': 135,
      'S': 180, 'SW': 225, 'W': 270, 'NW': 315
    };

    // 16-point compass (adds secondary intercardinal)
    const directionMap16 = {
      ...directionMap8,
      'NNE': 22.5, 'ENE': 67.5, 'ESE': 112.5, 'SSE': 157.5,
      'SSW': 202.5, 'WSW': 247.5, 'WNW': 292.5, 'NNW': 337.5
    };

    const map = secondary ? directionMap16 : directionMap8;
    return map[direction] !== undefined ? map[direction] : null;
  }

  //#endregion

  //#region =============== INSTANCE METHODS (Backwards Compatible Delegates) ===============
  // NOTE: These instance methods are simple delegates to the static methods above.
  // They are NOT individually documented to prevent cluttering child class documentation.
  // Refer to the static method documentation above for full details on parameters and usage.
  // All methods are functionally identical whether called as Utils.method() or instance.method()

  padZero(val, len){ return Utils.padZero(val, len) }
  arrSort(arr = [], asc = true){ return Utils.arrSort(arr, asc) }
  arrReverse(arr = []){ return Utils.arrReverse(arr) }
  arr2Sorted(arr = [], asc = true){ return Utils.arr2Sorted(arr, asc) }
  arr2Reversed(arr = []){ return Utils.arr2Reversed(arr) }
  arrRem(haystack, needle){ return Utils.arrRem(haystack, needle) }
  arr2Rem(haystack, needle){ return Utils.arr2Rem(haystack, needle) }
  arrSplice(haystack, needle, pos=null){ return Utils.arrSplice(haystack, needle, pos) }
  dtAddDays(dt, days){ return Utils.dtAddDays(dt, days) }
  dtMonthBounds(dt){ return Utils.dtMonthBounds(dt) }
  dtDaysDiff(dt1 = new Date(), dt2 = new Date()){ return Utils.dtDaysDiff(dt1, dt2) }
  iso2dt(str = ''){ return Utils.iso2dt(str) }
  dtStrip(str = ''){ return Utils.dtStrip(str) }
  dt2iso(dt = new Date()){ return Utils.dt2iso(dt) }
  dtStr2iso(dateStr){ return Utils.dtStr2iso(dateStr) }
  arrAnyInArr(arr1, arr2){ return Utils.arrAnyInArr(arr1, arr2) }
  arrCountItems(arr = []){ return Utils.arrCountItems(arr) }
  arrListDups(arr = []){ return Utils.arrListDups(arr) }
  arrUnique(arr){ return Utils.arrUnique(arr) }
  strAfter(val='',search='_'){ return Utils.strAfter(val, search) }
  strSuff(val='',search='_'){ return Utils.strSuff(val, search) }
  strBefore(val='',search='_'){ return Utils.strBefore(val, search) }
  isNumber(val){ return Utils.isNumber(val) }
  isDate(val){ return Utils.isDate(val) }
  isDateStr(str){ return Utils.isDateStr(str) }
  isISOdt(str = ''){ return Utils.isISOdt(str) }
  isBlank(val){ return Utils.isBlank(val) }
  isChoiceFieldValue(val){ return Utils.isChoiceFieldValue(val) }
  isAddressFieldValue(val){ return Utils.isAddressFieldValue(val) }
  fVal(val, naVal = null){ return Utils.fVal(val, naVal) }
  formatAddress(val = {}){ return Utils.formatAddress(val) }
  flipKVpair(obj){ return Utils.flipKVpair(obj) }
  str2html(strings, ...vals){ return Utils.str2html(strings, ...vals) }
  strProper(word){ return Utils.strProper(word) }
  dn2Title(str){ return Utils.dn2Title(str) }
  rowsFind(rows, key, val){ return Utils.rowsFind(rows, key, val) }
  rowsRem(rows, key, val){ return Utils.rowsRem(rows, key, val) }
  rows2Rem(rows, key, val){ return Utils.rows2Rem(rows, key, val) }
  rows2Sorted(arr, key = null, asc = true, type = 'string'){ return Utils.rows2Sorted(arr, key, asc, type) }
  dd2dms(dd, isLat){ return Utils.dd2dms(dd, isLat) }
  dms2dd(deg, min, sec, dir = 'N'){ return Utils.dms2dd(deg, min, sec, dir) }
  deg2Dir(degrees, secondary = false){ return Utils.deg2Dir(degrees, secondary) }
  dir2Deg(direction, secondary = false){ return Utils.dir2Deg(direction, secondary) }

  //#endregion
}
//#endregion

export { Utils };
</code></pre>
		</section>
			</div>
		</div>
	</div>
	<footer>
				<div class="copyright">Mtools Copyright © 2025 Mikel Paiva</div>
			<div class="generated-by">Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.11</a> on 13th Jan 2026 using the <a href="https://github.com/steveush/foodoc">FooDoc template</a>.</div>
	</footer>
	<script src="js/jquery.min.js"></script>
	<script src="js/bootstrap.min.js"></script>
	<script src="js/clipboard.min.js"></script>
	<script src="js/prism.min.js"></script>
	<script src="js/template.min.js"></script>
		<!-- start:lunr-search-modal.hbs -->
		<div class="modal fade" id="lunr-search-modal">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title">Search results</h4>
					</div>
					<div class="modal-body" id="lunr-search-body">
					</div>
					<div class="modal-footer" id="lunr-search-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
					</div>
				</div><!-- /.modal-content -->
			</div><!-- /.modal-dialog -->
		</div>
		<!-- end:lunr-search-modal.hbs -->		<script src="js/lunr.min.js"></script>
	
</body>
</html>
<!-- end:source.tmpl.hbs -->