<!-- start:readme.hbs -->
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width">
		<title>03_mapp</title>
		<!--[if lt IE 9]>
		<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->
		<link href="https://fonts.googleapis.com/css?family=PT+Mono" rel="stylesheet">
		<link type="text/css" rel="stylesheet" href="css/bootstrap.min.css">
		<link type="text/css" rel="stylesheet" href="css/prism.min.css">
		<link type="text/css" rel="stylesheet" href="css/template.min.css">
		<script type="text/javascript">
			window.TEMPLATE_OPTIONS = {"includeDate":true,"dateFormat":"Do MMM YYYY","systemName":"Merjent Fulcrum Tools","systemSummary":"Version 0.5.8","systemLogo":"","systemColor":"","navMembers":[{"kind":"module","title":"Modules","summary":"All documented modules."},{"kind":"class","title":"Classes","summary":"All documented classes. View inheritance chains in each class description."},{"kind":"external","title":"Externals","summary":"All documented external members."},{"kind":"global","title":"Globals","summary":"All documented globals."},{"kind":"mixin","title":"Mixins","summary":"All documented mixins."},{"kind":"interface","title":"Interfaces","summary":"All documented interfaces."},{"kind":"namespace","title":"Namespaces","summary":"All documented namespaces."},{"kind":"tutorial","title":"Tutorials","summary":"All available tutorials."}],"footer":"","copyright":"Mtools Copyright © 2025 Mikel Paiva","linenums":true,"collapseSymbols":true,"inverseNav":true,"inlineNav":false,"outputSourceFiles":false,"sourceRootPath":null,"disablePackagePath":true,"outputSourcePath":false,"showTableOfContents":true,"showAccessFilter":true,"analytics":null,"methodHeadingReturns":true,"sort":"lineage, longname","search":true,"favicon":null,"stylesheets":[],"scripts":[],"monospaceLinks":false,"cleverLinks":true,"default":{"outputSourceFiles":false}};
			window.DOCLET_TOC_ENABLED = true;
			window.DOCLET_AFILTER_ENABLED = false;
		</script>
</head>
<body>
	<!-- start:navbar.hbs -->
	<header class="navbar navbar-default navbar-fixed-top navbar-inverse">
		<div class="container">
			<div class="navbar-header">
				<a class="navbar-brand" href="index.html">
					Merjent Fulcrum Tools
				</a>
				<!-- displayed on small devices -->
				<button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#topNavigation">
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
			</div>
			<div class="navbar-collapse collapse" id="topNavigation">
				<ul class="nav navbar-nav">
								<li class="dropdown">
									<a href="list_class.html" class="dropdown-toggle" data-toggle="dropdown">Classes<b class="caret"></b></a>
									<ul class="dropdown-menu">
											<li><a href="DataEventHelpers.html">DataEventHelpers</a></li>
											<li><a href="FieldHelpers.html">FieldHelpers</a></li>
											<li><a href="FieldHelpers.MfldColl.html">FieldHelpers.MfldColl</a></li>
											<li><a href="FieldHelpers.MfldTypes.html">FieldHelpers.MfldTypes</a></li>
											<li><a href="FulcrumHelpers.html">FulcrumHelpers</a></li>
											<li><a href="MerjentApp.html">MerjentApp</a></li>
											<li><a href="Mfld.html">Mfld</a></li>
											<li><a href="MLoadRecords.html">MLoadRecords</a></li>
											<li><a href="PhotoDirHandler.html">PhotoDirHandler</a></li>
											<li><a href="ReportHelpers.html">ReportHelpers</a></li>
											<li><a href="ReportHelpers.SecOpt.html">ReportHelpers.SecOpt</a></li>
											<li><a href="RequestHelpers.html">RequestHelpers</a></li>
											<li><a href="Utils.html">Utils</a></li>
									</ul>
								</li>
								<li class="dropdown">
									<a href="list_module.html" class="dropdown-toggle" data-toggle="dropdown">Modules<b class="caret"></b></a>
									<ul class="dropdown-menu">
											<li><a href="module-MtoolsDataEvents.html">MtoolsDataEvents</a></li>
											<li><a href="module-MtoolsMerjentApp.html">MtoolsMerjentApp</a></li>
											<li><a href="module-MtoolsReports.html">MtoolsReports</a></li>
											<li><a href="module-MtoolsUtils.html">MtoolsUtils</a></li>
									</ul>
								</li>
								<li class="dropdown">
									<a href="list_namespace.html" class="dropdown-toggle" data-toggle="dropdown">Namespaces<b class="caret"></b></a>
									<ul class="dropdown-menu">
											<li><a href="DefaultTemplate.html">DefaultTemplate</a></li>
											<li><a href="LockingMixins.html">LockingMixins</a></li>
											<li><a href="PermissionMixins.html">PermissionMixins</a></li>
											<li><a href="PhotoMixins.html">PhotoMixins</a></li>
											<li><a href="StatusMixins.html">StatusMixins</a></li>
									</ul>
								</li>
								<li class="dropdown">
									<a href="list_tutorial.html" class="dropdown-toggle" data-toggle="dropdown">Tutorials<b class="caret"></b></a>
									<ul class="dropdown-menu">
											<li><a href="tutorial-CHANGELOG.html">CHANGELOG</a></li>
											<li><a href="tutorial-01_overview.html">01_overview</a></li>
											<li><a href="tutorial-02_5_mloadrecords.html">02_5_mloadrecords</a></li>
											<li><a href="tutorial-02_mtools.html">02_mtools</a></li>
											<li><a href="tutorial-03_mapp.html">03_mapp</a></li>
											<li><a href="tutorial-04_pdf-reports.html">04_pdf-reports</a></li>
											<li><a href="tutorial-06_merjent-dev.html">06_merjent-dev</a></li>
											<li><a href="tutorial-07_general-dev.html">07_general-dev</a></li>
											<li><a href="tutorial-08_mapp-cheat-sheet.html">08_mapp-cheat-sheet</a></li>
									</ul>
								</li>
				</ul>
					<!-- start:lunr-search-navbar.hbs -->
					<form class="navbar-form navbar-right" role="search">
						<div class="input-group">
							<input type="text" class="form-control" placeholder="Search" id="lunr-search-input">
							<div class="input-group-btn">
								<button class="btn btn-default" id="lunr-search-submit">
									<i class="glyphicon glyphicon-search"></i>
								</button>
							</div>
						</div>
					</form>
					<!-- start:lunr-search-navbar.hbs -->		</div>
		</div>
	</header>
	<!-- end:navbar.hbs -->		<div class="page-header">
			<div class="container">
				<span class="kind">tutorial</span>
				<h1><span class="title">03_mapp</span></h1>
			</div>
		</div>
	<div class="container content">
		<div class="row">
			<div class="col-md-9 main-content">
						<ol class="breadcrumb">
							<li><a href="index.html">Home</a></li>
							<li><a href="list_tutorial.html">Tutorials</a></li>
							<li class="active">03_mapp</li>
						</ol>
		<section class="tutorial-section">
			<article><h1>MerjentApp (Mapp) Module</h1>
<h2>Overview</h2>
<p><strong>MerjentApp</strong> (abbreviated as <code>Mapp</code> or <code>mapp</code>) is a class that streamlines the creation of Fulcrum apps with standard Merjent workflows. It handles permission control, status updates, and field locking automatically, reducing boilerplate code and ensuring consistency across apps.</p>
<h3>The Problem</h3>
<p>Building Merjent Fulcrum apps typically requires:</p>
<ul>
<li><strong>Role-based permissions</strong> - Field staff can't edit PM-only fields</li>
<li><strong>Status workflows</strong> - Forms progress through Pending → Submitted → Reviewed → Complete</li>
<li><strong>Field locking</strong> - Submitted forms can't be edited (except by PMs)</li>
<li><strong>Photo validation</strong> - Photos must have location data</li>
<li><strong>Coordinator approvals</strong> - Tracking who reviewed/approved</li>
</ul>
<p>Writing this logic from scratch in every app is:</p>
<ul>
<li>Time-consuming (100+ lines of repetitive code)</li>
<li>Error-prone (easy to miss edge cases)</li>
<li>Inconsistent (different implementations across apps)</li>
</ul>
<h3>The Solution</h3>
<p>MerjentApp provides <strong>pre-built mixins</strong> for common workflows:</p>
<pre class="prettyprint source lang-javascript"><code>const mApp = module.exports.MerjentApp;

// Configure once
mApp.dnSubmit = 'submit_report';
mApp.completeLockCondition = ['Complete'];

// Use everywhere
ON('load-record', mApp.start);  // Auto-handles permissions & locking
ON('change', mApp.dnSubmit, mApp.updateStatus);  // Auto-updates status
</code></pre>
<hr>
<h2>Important Things to Remember</h2>
<p>Before configuring MerjentApp, keep these critical points in mind:</p>
<h3>✅ Configure BEFORE Event Handlers</h3>
<pre class="prettyprint source lang-javascript"><code>// ✓ CORRECT - Configure first, then attach events
mApp.dnSubmit = 'submit_report';
mApp.completeLockCondition = ['Complete'];
mApp.getStatus = mApp.statusMethods.p_s_complete;

ON('load-record', mApp.start);
ON('change', mApp.dnSubmit, mApp.updateStatus);

// ✗ WRONG - Events attached before configuration
ON('load-record', mApp.start);  // Won't work correctly
mApp.dnSubmit = 'submit_report';  // Too late!
</code></pre>
<h3>✅ Required Properties</h3>
<p>Always set these three properties:</p>
<pre class="prettyprint source lang-javascript"><code>mApp.dnSubmit = 'submit_report';              // Required
mApp.completeLockCondition = ['Complete'];     // Required
mApp.getStatus = mApp.statusMethods.p_s_complete;  // Required
</code></pre>
<h3>✅ Use Property References</h3>
<pre class="prettyprint source lang-javascript"><code>// ✓ GOOD - Use mApp properties
ON('change', mApp.dnSubmit, mApp.updateStatus);

// ✗ AVOID - Hardcoded data names
ON('change', 'submit_report', mApp.updateStatus);
</code></pre>
<p>If you change the field data name, you only need to update one line.</p>
<h3>✅ Always Use mApp.start on Load</h3>
<pre class="prettyprint source lang-javascript"><code>// ✓ REQUIRED
ON('load-record', mApp.start);
</code></pre>
<p>This sets permissions AND locks fields. Don't skip it!</p>
<h3>✅ Test with Different User Roles</h3>
<p>Always test your app as:</p>
<ul>
<li>Admin user</li>
<li>Editor user</li>
<li>Regular user (default permission level)</li>
<li>User not in any list</li>
</ul>
<h3>✅ Use Correct Case</h3>
<pre class="prettyprint source lang-javascript"><code>// ✓ CORRECT
const mApp = module.exports.MerjentApp
mApp.dnSubmit = 'submit_report';

// ✗ WRONG - lowercase 'app'
const mApp = module.exports.MerjentApp
mapp.dnSubmit = 'submit_report';  // Undefined!
</code></pre>
<hr>
<h2>Installation</h2>
<p>MerjentApp is included in <code>merjent-tools-mApp.mmin.js</code>:</p>
<pre class="prettyprint source lang-javascript"><code>//#region !START MERJENT FULCRUM TOOLS!
// ... paste merjent-tools-mApp.mmin.js content here ...
//#endregion !END MERJENT FULCRUM TOOLS!

// Instantiate both Mtools and MApp
const M = module.exports.Mtools
const mApp = module.exports.MerjentApp
</code></pre>
<p><strong>Note:</strong> <code>merjent-tools-mApp.mmin.js</code> includes everything from <code>merjent-tools-de.mmin.js</code> plus the <code>MApp</code> class.</p>
<hr>
<h2>Core Concepts</h2>
<h3>Permission Levels</h3>
<p>MerjentApp recognizes four user roles (from least to most privileged):</p>
<table>
<thead>
<tr>
<th>Level</th>
<th>Description</th>
<th>Typical Users</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Viewer</strong></td>
<td>Read-only access</td>
<td>Stakeholders, clients</td>
</tr>
<tr>
<td><strong>User</strong></td>
<td>Standard field staff</td>
<td>Field biologists, surveyors</td>
</tr>
<tr>
<td><strong>Editor</strong></td>
<td>Project coordinators</td>
<td>Coord</td>
</tr>
</tbody>
</table>
<p>inators, senior staff |
| <strong>Admin</strong> | Project managers | PMs, administrators |</p>
<h3>Status Workflow</h3>
<p>Typical progression:</p>
<pre class="prettyprint source"><code>Pending → Submitted → Reviewed → Complete
   ↓          ↓          ↓           ↓
(editing)  (locked)   (PM review) (archived)
</code></pre>
<h3>Field Locking</h3>
<p>Two types of locks:</p>
<ol>
<li><strong>Field Lock</strong> - Locks most fields when status reaches certain value (e.g., &quot;Submitted&quot;)</li>
<li><strong>Complete Lock</strong> - Locks ALL fields when status reaches final value (e.g., &quot;Complete&quot;)</li>
</ol>
<p>Both support <strong>exclusion lists</strong> for fields that should remain editable.</p>
<hr>
<h2>Basic Configuration</h2>
<h3>Minimal Setup</h3>
<pre class="prettyprint source lang-javascript"><code>const mApp = module.exports.MerjentApp

// Required: Status field data name
mApp.dnSubmit = 'submit_report';

// Required: Lock condition (status values that trigger locking)
mApp.completeLockCondition = ['Complete', 'Resolved'];

// Required: Status calculation method
mApp.getStatus = mApp.statusMethods.p_s_complete;

// Attach to data events
ON('load-record', mApp.start);
ON('change', mApp.dnSubmit, mApp.updateStatus);
</code></pre>
<h3>Full Configuration Example</h3>
<pre class="prettyprint source lang-javascript"><code>const mApp = module.exports.MerjentApp

//********** User Permissions **********
mApp.adminNames = ['Jane Smith', 'John Doe'];
mApp.editorNames = ['Alice Johnson'];
mApp.editorRoles = ['Coordinator'];
mApp.defaultPermissionLevel = 'User';

//********** Status Fields **********
mApp.dnSubmit = 'submit_report';
mApp.dnReviewed = 'coordinator_reviewed';
mApp.dnCoordinatorInitials = 'coordinator_initials';
mApp.dnFollowUp = 'follow_up_required';
mApp.dnResolved = 'follow_up_closed';

//********** Status Method **********
mApp.getStatus = mApp.statusMethods.p_s_complete;

//********** Field Locking **********
mApp.fieldLockCondition = ['Submitted'];
mApp.fieldLockExclude = [mApp.dnSubmit];

mApp.completeLockCondition = ['Complete', 'Resolved'];
mApp.completeLockExclude = [mApp.dnSubmit, mApp.dnReviewed];

//********** Photo Settings **********
mApp.dnPhotoLoc = 'site_photos';
mApp.allPhotos = ['site_photos', 'equipment_photos'];
mApp.requireLandscape = false;
mApp.setLocoff1photo = true;

//********** Other Settings **********
mApp.disableLocationEdit = false;
mApp.dnAutoName = 'inspector_name';  // Auto-fill with user's name on new record
mApp.dnDt = 'date';
mApp.dnReportID = 'report_id';

//********** Data Events **********
ON('load-record', mApp.start);
ON('change', mApp.dnSubmit, mApp.updateStatus);
ON('change', mApp.dnReviewed, mApp.addCoordinatorInitials);
ON('add-photo', mApp.dnPhotoLoc, mApp.validatePhoto);
</code></pre>
<hr>
<h2>Configuration Reference</h2>
<h3>Permission Settings</h3>
<h4><code>mApp.adminNames</code></h4>
<p><strong>Type:</strong> <code>Array&lt;string&gt;</code>
<strong>Default:</strong> <code>[]</code>
<strong>Description:</strong> Names of users with Admin permission level</p>
<pre class="prettyprint source lang-javascript"><code>mApp.adminNames = ['Jane Smith', 'John Doe'];
</code></pre>
<h4><code>mApp.editorNames</code></h4>
<p><strong>Type:</strong> <code>Array&lt;string&gt;</code>
<strong>Default:</strong> <code>[]</code>
<strong>Description:</strong> Names of users with Editor permission level</p>
<pre class="prettyprint source lang-javascript"><code>mApp.editorNames = ['Alice Johnson', 'Bob Wilson'];
</code></pre>
<h4><code>mApp.editorRoles</code></h4>
<p><strong>Type:</strong> <code>Array&lt;string&gt;</code>
<strong>Default:</strong> <code>[]</code>
<strong>Description:</strong> Fulcrum role names that get Editor permission level</p>
<pre class="prettyprint source lang-javascript"><code>mApp.editorRoles = ['Coordinator', 'Senior Staff'];
</code></pre>
<h4><code>mApp.defaultPermissionLevel</code></h4>
<p><strong>Type:</strong> <code>string</code>
<strong>Default:</strong> <code>'User'</code>
<strong>Description:</strong> Default permission level for users not in other lists</p>
<pre class="prettyprint source lang-javascript"><code>mApp.defaultPermissionLevel = 'Viewer';  // Make most users read-only
</code></pre>
<hr>
<h3>Status Field Settings</h3>
<h4><code>mApp.dnSubmit</code> ⚠️ Required</h4>
<p><strong>Type:</strong> <code>string</code>
<strong>Description:</strong> Data name of the submission field (Yes/No or Choice field)</p>
<pre class="prettyprint source lang-javascript"><code>mApp.dnSubmit = 'submit_report';
</code></pre>
<h4><code>mApp.dnReviewed</code></h4>
<p><strong>Type:</strong> <code>string</code>
<strong>Description:</strong> Data name of the reviewed/approved field</p>
<pre class="prettyprint source lang-javascript"><code>mApp.dnReviewed = 'coordinator_reviewed';
</code></pre>
<h4><code>mApp.dnCoordinatorInitials</code></h4>
<p><strong>Type:</strong> <code>string</code>
<strong>Description:</strong> Data name of field to store coordinator's initials</p>
<pre class="prettyprint source lang-javascript"><code>mApp.dnCoordinatorInitials = 'coordinator_initials';
</code></pre>
<h4><code>mApp.dnFollowUp</code></h4>
<p><strong>Type:</strong> <code>string</code>
<strong>Description:</strong> Data name of follow-up required field</p>
<pre class="prettyprint source lang-javascript"><code>mApp.dnFollowUp = 'follow_up_required';
</code></pre>
<h4><code>mApp.dnResolved</code></h4>
<p><strong>Type:</strong> <code>string</code>
<strong>Description:</strong> Data name of follow-up resolved field</p>
<pre class="prettyprint source lang-javascript"><code>mApp.dnResolved = 'follow_up_closed';
</code></pre>
<hr>
<h3>Locking Settings</h3>
<h4><code>mApp.fieldLockCondition</code></h4>
<p><strong>Type:</strong> <code>Array&lt;string&gt;</code> or <code>null</code>
<strong>Default:</strong> <code>['Submitted']</code>
<strong>Description:</strong> Status values that trigger field locking (partial lock)</p>
<pre class="prettyprint source lang-javascript"><code>mApp.fieldLockCondition = ['Submitted', 'In Review'];
</code></pre>
<p>Set to <code>null</code> to disable field locking:</p>
<pre class="prettyprint source lang-javascript"><code>mApp.fieldLockCondition = null;
</code></pre>
<h4><code>mApp.fieldLockExclude</code></h4>
<p><strong>Type:</strong> <code>Array&lt;string&gt;</code>
<strong>Default:</strong> <code>[]</code>
<strong>Description:</strong> Data names of fields excluded from field lock</p>
<pre class="prettyprint source lang-javascript"><code>mApp.fieldLockExclude = [mApp.dnSubmit, 'notes'];
</code></pre>
<h4><code>mApp.completeLockCondition</code> ⚠️ Required</h4>
<p><strong>Type:</strong> <code>Array&lt;string&gt;</code> or <code>null</code>
<strong>Default:</strong> <code>['Complete', 'Resolved']</code>
<strong>Description:</strong> Status values that trigger complete lock (all fields)</p>
<pre class="prettyprint source lang-javascript"><code>mApp.completeLockCondition = ['Complete', 'Archived'];
</code></pre>
<p>Set to <code>null</code> to disable complete locking:</p>
<pre class="prettyprint source lang-javascript"><code>mApp.completeLockCondition = null;
</code></pre>
<h4><code>mApp.completeLockExclude</code></h4>
<p><strong>Type:</strong> <code>Array&lt;string&gt;</code>
<strong>Default:</strong> <code>[]</code>
<strong>Description:</strong> Data names of fields excluded from complete lock (Admin only)</p>
<pre class="prettyprint source lang-javascript"><code>mApp.completeLockExclude = [mApp.dnSubmit, mApp.dnReviewed];
</code></pre>
<hr>
<h3>Photo Settings</h3>
<h4><code>mApp.dnPhotoLoc</code></h4>
<p><strong>Type:</strong> <code>string</code>
<strong>Description:</strong> Data name of primary location photo field</p>
<pre class="prettyprint source lang-javascript"><code>mApp.dnPhotoLoc = 'site_photos';
</code></pre>
<h4><code>mApp.allPhotos</code></h4>
<p><strong>Type:</strong> <code>Array&lt;string&gt;</code>
<strong>Description:</strong> Data names of all photo fields in form</p>
<pre class="prettyprint source lang-javascript"><code>mApp.allPhotos = ['site_photos', 'equipment_photos', 'species_photos'];
</code></pre>
<h4><code>mApp.requireLandscape</code></h4>
<p><strong>Type:</strong> <code>boolean</code>
<strong>Default:</strong> <code>false</code>
<strong>Description:</strong> Require photos to be in landscape orientation</p>
<pre class="prettyprint source lang-javascript"><code>mApp.requireLandscape = true;
</code></pre>
<h4><code>mApp.setLocoff1photo</code></h4>
<p><strong>Type:</strong> <code>boolean</code>
<strong>Default:</strong> <code>false</code>
<strong>Description:</strong> Turn off location services after first photo with location</p>
<pre class="prettyprint source lang-javascript"><code>mApp.setLocoff1photo = true;
</code></pre>
<hr>
<h3>Other Settings</h3>
<h4><code>mApp.disableLocationEdit</code></h4>
<p><strong>Type:</strong> <code>boolean</code>
<strong>Default:</strong> <code>false</code>
<strong>Description:</strong> Prevent users from manually editing record location</p>
<pre class="prettyprint source lang-javascript"><code>mApp.disableLocationEdit = true;
</code></pre>
<h4><code>mApp.dnAutoName</code></h4>
<p><strong>Type:</strong> <code>string</code> or <code>null</code>
<strong>Default:</strong> <code>null</code>
<strong>Description:</strong> Data name of field to auto-populate with user's full name on new record creation. Set to <code>null</code> to disable.</p>
<pre class="prettyprint source lang-javascript"><code>mApp.dnAutoName = 'inspector_name';
</code></pre>
<p>When set, <code>mApp.start()</code> registers a <code>new-record</code> event handler that automatically sets the specified field to the current user's full name via <code>USERFULLNAME()</code>.</p>
<p><strong>Use case:</strong> Pre-fill inspector/surveyor name fields so users don't have to type their name on every new record.</p>
<h4><code>mApp.dnDt</code></h4>
<p><strong>Type:</strong> <code>string</code>
<strong>Description:</strong> Data name of date field</p>
<pre class="prettyprint source lang-javascript"><code>mApp.dnDt = 'observation_date';
</code></pre>
<h4><code>mApp.dnReportID</code></h4>
<p><strong>Type:</strong> <code>string</code>
<strong>Description:</strong> Data name of report ID field</p>
<pre class="prettyprint source lang-javascript"><code>mApp.dnReportID = 'report_id';
</code></pre>
<hr>
<h2>Status Methods</h2>
<p>The <code>getStatus</code> property determines how status is calculated. MerjentApp provides several pre-built status methods:</p>
<h3><code>mApp.statusMethods.p_s_complete</code></h3>
<p><strong>Pattern:</strong> Pending → Submitted → Complete</p>
<pre class="prettyprint source lang-javascript"><code>mApp.getStatus = mApp.statusMethods.p_s_complete;
</code></pre>
<p><strong>Logic:</strong></p>
<ul>
<li>If follow-up resolved: &quot;Resolved&quot;</li>
<li>If follow-up required: &quot;Follow-up Required&quot;</li>
<li>If reviewed: &quot;Complete&quot;</li>
<li>If submitted: &quot;Submitted&quot;</li>
<li>Otherwise: &quot;Pending&quot;</li>
</ul>
<p><strong>Required Fields:</strong></p>
<ul>
<li><code>dnSubmit</code></li>
<li><code>dnReviewed</code> (optional)</li>
<li><code>dnFollowUp</code> (optional)</li>
<li><code>dnResolved</code> (optional)</li>
</ul>
<h3>Other Status Methods</h3>
<p>Check the <a href="./MerjentApp.StatusMixins.html">API documentation</a> for additional status methods:</p>
<ul>
<li><code>p_s_r_complete</code> - Pending → Submitted → Reviewed → Complete</li>
<li><code>p_complete</code> - Pending → Complete</li>
<li>Custom methods can be added</li>
</ul>
<hr>
<h2>Common Configuration Patterns</h2>
<h3>Pattern 1: Standard Merjent App (Default)</h3>
<p>Most Merjent apps use this configuration:</p>
<pre class="prettyprint source lang-javascript"><code>mApp.dnSubmit = 'submit_report';
mApp.dnReviewed = 'coordinator_reviewed';
mApp.dnCoordinatorInitials = 'coordinator_initials';

mApp.completeLockCondition = ['Complete', 'Resolved'];
mApp.fieldLockCondition = ['Submitted'];
mApp.fieldLockExclude = [mApp.dnSubmit];
mApp.completeLockExclude = [mApp.dnSubmit, mApp.dnReviewed];

mApp.getStatus = mApp.statusMethods.p_s_complete;

ON('load-record', mApp.start);
ON('change', mApp.dnSubmit, mApp.updateStatus);
ON('change', mApp.dnReviewed, mApp.addCoordinatorInitials);
</code></pre>
<p><strong>Use when:</strong> Standard PM/Coordinator/Field Staff workflow</p>
<hr>
<h3>Pattern 2: No PM Review (User-Only App)</h3>
<p>For apps where everyone has the same permissions:</p>
<pre class="prettyprint source lang-javascript"><code>mApp.dnSubmit = 'submit_report';

mApp.completeLockCondition = null;  // No complete lock
mApp.fieldLockCondition = ['Submitted'];
mApp.fieldLockExclude = [mApp.dnSubmit];

mApp.getStatus = mApp.statusMethods.p_s_complete;

ON('load-record', mApp.start);
ON('change', mApp.dnSubmit, mApp.updateStatus);
</code></pre>
<p><strong>Use when:</strong> No PM approval needed, just prevent editing after submission</p>
<hr>
<h3>Pattern 3: No Status/Locking (Permissions Only)</h3>
<p>For simple apps that only need permission control:</p>
<pre class="prettyprint source lang-javascript"><code>mApp.adminNames = ['Jane Smith'];
mApp.editorNames = ['Bob Wilson'];

mApp.dnSubmit = null;
mApp.completeLockCondition = null;
mApp.fieldLockCondition = null;

ON('load-record', mApp.setPermissions);  // Only set permissions, no locking
</code></pre>
<p><strong>Use when:</strong> You want role-based field restrictions but no workflow</p>
<hr>
<h3>Pattern 4: Read-Only Archive</h3>
<p>For completed projects where data should be locked:</p>
<pre class="prettyprint source lang-javascript"><code>mApp.adminNames = ['Jane Smith'];  // Only PM can edit

mApp.dnSubmit = null;
mApp.completeLockCondition = null;
mApp.fieldLockCondition = null;
mApp.defaultPermissionLevel = 'Viewer';  // Everyone else is read-only

ON('load-record', mApp.setPermissions);
</code></pre>
<p><strong>Use when:</strong> Project complete, data archived, minimal editing needed</p>
<hr>
<h2>Data Event Handlers</h2>
<h3><code>mApp.start()</code></h3>
<p><strong>Description:</strong> Main initialization handler - sets permissions and locks fields</p>
<p><strong>Usage:</strong></p>
<pre class="prettyprint source lang-javascript"><code>ON('load-record', mApp.start);
</code></pre>
<p><strong>What it does:</strong></p>
<ol>
<li>Calls <code>mApp.setPermissions()</code> to determine user's role</li>
<li>Calls <code>mApp.setFieldLocks()</code> to lock fields based on status</li>
<li>Calls <code>mApp.setCompleteLock()</code> to lock all fields if complete</li>
</ol>
<p><strong>When to use:</strong> Always use this in the <code>load-record</code> event</p>
<hr>
<h3><code>mApp.updateStatus()</code></h3>
<p><strong>Description:</strong> Automatically updates form status based on field values</p>
<p><strong>Usage:</strong></p>
<pre class="prettyprint source lang-javascript"><code>ON('change', mApp.dnSubmit, mApp.updateStatus);
</code></pre>
<p><strong>What it does:</strong></p>
<ol>
<li>Calls <code>mApp.getStatus()</code> to calculate new status</li>
<li>Updates form status using <code>SETSTATUS()</code></li>
</ol>
<p><strong>When to use:</strong> Whenever status-related fields change</p>
<hr>
<h3><code>mApp.addCoordinatorInitials()</code></h3>
<p><strong>Description:</strong> Adds coordinator's initials when they review the form</p>
<p><strong>Usage:</strong></p>
<pre class="prettyprint source lang-javascript"><code>ON('change', mApp.dnReviewed, mApp.addCoordinatorInitials);
</code></pre>
<p><strong>What it does:</strong></p>
<ol>
<li>Gets current user's name</li>
<li>Extracts initials</li>
<li>Sets value in <code>mApp.dnCoordinatorInitials</code> field</li>
</ol>
<p><strong>When to use:</strong> When coordinators review/approve forms</p>
<hr>
<h3><code>mApp.validatePhoto()</code></h3>
<p><strong>Description:</strong> Validates photo has location data and correct orientation</p>
<p><strong>Usage:</strong></p>
<pre class="prettyprint source lang-javascript"><code>ON('add-photo', mApp.dnPhotoLoc, mApp.validatePhoto);
</code></pre>
<p><strong>What it does:</strong></p>
<ol>
<li>Checks if photo has GPS coordinates</li>
<li>If <code>requireLandscape</code>, checks orientation</li>
<li>Shows alert if validation fails</li>
</ol>
<p><strong>When to use:</strong> For photo fields that require location data</p>
<hr>
<h3><code>mApp.disableNewRecordCreation()</code></h3>
<p><strong>Description:</strong> Prevents users from creating new records</p>
<p><strong>Usage:</strong></p>
<pre class="prettyprint source lang-javascript"><code>ON('new-record', mApp.disableNewRecordCreation);
</code></pre>
<p><strong>What it does:</strong></p>
<ol>
<li>Shows alert explaining why record creation is disabled</li>
<li>Calls <code>QUIT()</code> to exit</li>
</ol>
<p><strong>When to use:</strong> For forms where only admins should create records, or project is complete</p>
<hr>
<h2>Advanced Usage</h2>
<h3>Custom Status Calculation</h3>
<p>Create your own status method:</p>
<pre class="prettyprint source lang-javascript"><code>mApp.getStatus = function() {
  const submitted = this.getVal(this.dnSubmit);
  const approved = this.getVal('pm_approved');
  const deployed = this.getVal('equipment_deployed');

  if (deployed === 'yes') return 'Deployed';
  if (approved === 'yes') return 'Approved';
  if (submitted === 'yes') return 'Submitted';
  return 'Draft';
};

ON('change', mApp.dnSubmit, mApp.updateStatus);
ON('change', 'pm_approved', mApp.updateStatus);
ON('change', 'equipment_deployed', mApp.updateStatus);
</code></pre>
<h3>Conditional Locking</h3>
<p>Customize field locks based on complex logic:</p>
<pre class="prettyprint source lang-javascript"><code>function customLockFields() {
  mApp.setPermissions();  // Set user's permission level first

  const status = STATUS();
  const userLevel = mApp.permissionLevel;

  // Custom locking logic
  if (status === 'Submitted' && userLevel === 'User') {
    // Lock everything for Users
    const allFields = FIELDNAMES();
    allFields.forEach(dn => {
      if (dn !== mApp.dnSubmit) {
        SETFORMATTRIBUTES(dn, {disabled: true});
      }
    });
  }
}

ON('load-record', customLockFields);
</code></pre>
<h3>Dynamic Permission Assignment</h3>
<p>Assign permissions based on record data:</p>
<pre class="prettyprint source lang-javascript"><code>ON('load-record', () => {
  mApp.setPermissions();

  const projectLead = mApp.getVal('project_lead');
  const currentUser = CURRENTUSER().name;

  // Project lead gets Editor permissions
  if (projectLead === currentUser && mApp.permissionLevel === 'User') {
    mApp.permissionLevel = 'Editor';
  }

  mApp.setFieldLocks();
  mApp.setCompleteLock();
});
</code></pre>
<hr>
<h2>Troubleshooting</h2>
<h3>Issue: Fields not locking properly</h3>
<p><strong>Cause:</strong> MApp not initialized or status conditions incorrect</p>
<p><strong>Solution:</strong></p>
<pre class="prettyprint source lang-javascript"><code>// Make sure you call mApp.start() on load-record
ON('load-record', mApp.start);

// Check status conditions match your status values exactly
console.log('Current status:', STATUS());
console.log('Field lock condition:', mApp.fieldLockCondition);
console.log('Complete lock condition:', mApp.completeLockCondition);
</code></pre>
<h3>Issue: Permissions not working</h3>
<p><strong>Cause:</strong> Names don't match exactly, or user has no Fulcrum role</p>
<p><strong>Solution:</strong></p>
<pre class="prettyprint source lang-javascript"><code>// Check user's name and roles
ON('load-record', () => {
  console.log('Current user:', CURRENTUSER().name);
  console.log('User roles:', CURRENTUSER().roles);
  console.log('Permission level:', mApp.permissionLevel);
});

// Names must match EXACTLY (case-sensitive)
mApp.adminNames = ['Jane Smith'];  // Won't match 'jane smith' or 'Jane  Smith'
</code></pre>
<h3>Issue: Status not updating</h3>
<p><strong>Cause:</strong> <code>getStatus</code> method not set, or event handler not attached</p>
<p><strong>Solution:</strong></p>
<pre class="prettyprint source lang-javascript"><code>// Required: Set status method
mApp.getStatus = mApp.statusMethods.p_s_complete;

// Required: Attach event handler
ON('change', mApp.dnSubmit, mApp.updateStatus);

// Debug: Check what status should be
console.log('Calculated status:', mApp.getStatus());
</code></pre>
<hr>
<h2>Best Practices</h2>
<h3>1. Always Configure Before Event Handlers</h3>
<pre class="prettyprint source lang-javascript"><code>// CORRECT: Configure first
mApp.dnSubmit = 'submit_report';
mApp.getStatus = mApp.statusMethods.p_s_complete;

ON('load-record', mApp.start);

// WRONG: Event handlers before configuration
ON('load-record', mApp.start);  // Won't work right
mApp.dnSubmit = 'submit_report';  // Too late!
</code></pre>
<h3>2. Use Property References in Event Handlers</h3>
<pre class="prettyprint source lang-javascript"><code>// CORRECT: Use mApp.dnSubmit
ON('change', mApp.dnSubmit, mApp.updateStatus);

// WRONG: Hardcoded data name
ON('change', 'submit_report', mApp.updateStatus);
</code></pre>
<p>This way, if you change the data name, you only update one line.</p>
<h3>3. Test with Different User Roles</h3>
<p>Always test your app with:</p>
<ul>
<li>Admin user</li>
<li>Editor user</li>
<li>Regular user</li>
<li>User not in any list (default permission level)</li>
</ul>
<h3>4. Document Your Configuration</h3>
<pre class="prettyprint source lang-javascript"><code>//********************************************* MERJENT APP  *************************************/
// APP CONFIGURATION:
// - Admins: Jane Smith, John Doe
// - Editors: Coordinator role
// - Status: Pending → Submitted → Complete
// - Field Lock: Submitted (users can't edit)
// - Complete Lock: Complete (only admins can edit excluded fields)

mApp.adminNames = ['Jane Smith', 'John Doe'];
mApp.editorRoles = ['Coordinator'];
// ... rest of configuration
</code></pre>
<hr>
<h2>Next Steps</h2>
<ul>
<li>Review <a href="./tutorial-02_mtools.html">Mtools Tutorial</a> for helper methods</li>
<li>Explore <a href="./tutorial-04_pdf-reports.html">PDF Reports</a> for report generation</li>
<li>Check the <a href="./MerjentApp.html">API documentation</a> for all methods and mixins</li>
</ul>
<hr>
<h2>Additional Resources</h2>
<ul>
<li><a href="./MerjentApp.html">MerjentApp API Reference</a></li>
<li><a href="./MerjentApp.PermissionMixins.html">Permission Mixins</a></li>
<li><a href="./MerjentApp.StatusMixins.html">Status Mixins</a></li>
<li><a href="./MerjentApp.LockingMixins.html">Locking Mixins</a></li>
<li><a href="./MerjentApp.PhotoMixins.html">Photo Mixins</a></li>
</ul></article>
		</section>
			</div>
				<div class="col-md-3 side-content">
					<nav class="toc hidden-print hidden-sm hidden-xs"></nav>
				</div>
		</div>
	</div>
	<footer>
				<div class="copyright">Mtools Copyright © 2025 Mikel Paiva</div>
			<div class="generated-by">Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.11</a> on 24th Feb 2026 using the <a href="https://github.com/steveush/foodoc">FooDoc template</a>.</div>
	</footer>
	<script src="js/jquery.min.js"></script>
	<script src="js/bootstrap.min.js"></script>
	<script src="js/clipboard.min.js"></script>
	<script src="js/prism.min.js"></script>
	<script src="js/template.min.js"></script>
		<!-- start:lunr-search-modal.hbs -->
		<div class="modal fade" id="lunr-search-modal">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title">Search results</h4>
					</div>
					<div class="modal-body" id="lunr-search-body">
					</div>
					<div class="modal-footer" id="lunr-search-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
					</div>
				</div><!-- /.modal-content -->
			</div><!-- /.modal-dialog -->
		</div>
		<!-- end:lunr-search-modal.hbs -->		<script src="js/lunr.min.js"></script>
	
</body>
</html>
<!-- end:readme.hbs -->